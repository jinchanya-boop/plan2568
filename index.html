<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .signature-pad { border: 2px dashed #d1d5db; background: #f9fafb; }
        .signature-pad canvas { display: block; }
        @media print {
            .no-print { display: none !important; }
            body { font-size: 12px; }
        }
        .config-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .pdf-item {
            transition: all 0.2s ease;
        }
        .pdf-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Google Apps Script Configuration Panel -->
    <div id="configPanel" class="config-panel text-white p-6 mb-6 hidden">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-xl font-bold mb-4">üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script</h2>
            <div class="grid grid-cols-1 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Google Apps Script Web App URL</label>
                    <input type="text" id="scriptUrl" class="w-full px-3 py-2 rounded-md text-gray-900" 
                           placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                    <p class="text-xs mt-1 opacity-80">URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà deploy ‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
            </div>
            <div class="flex gap-4 mt-4">
                <button onclick="testScriptConnection()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-md transition-colors">
                    üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
                <button onclick="showScriptInstructions()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md transition-colors">
                    üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á Apps Script
                </button>
                <button onclick="toggleConfig()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-md transition-colors">
                    ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>
            <div id="connectionStatus" class="mt-4 p-3 rounded-md bg-black bg-opacity-20 hidden">
                <p id="statusMessage"></p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">üè´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h1>
                        <p class="text-sm text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="syncStatus" class="text-sm text-gray-600">
                        <span class="inline-flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets
                        </span>
                    </div>
                    <button onclick="toggleConfig()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                    <button onclick="showDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button onclick="showForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        üìù ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <div id="dashboard" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-900">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                    <button onclick="syncFromSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors font-medium">
                        üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                    <button onclick="showPDFExports()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition-colors font-medium text-lg">
                        üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-blue-100">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p class="text-3xl font-bold" id="totalProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üìã</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-green-100">‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
                            <p class="text-3xl font-bold" id="successProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚úÖ</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-yellow-100">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                            <p class="text-3xl font-bold" id="pendingProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚è≥</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-red-100">‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
                            <p class="text-3xl font-bold" id="failedProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚ùå</div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Department Chart -->
                <div class="bg-white rounded-lg p-6 shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</h3>
                    <div class="relative h-64">
                        <canvas id="departmentChart"></canvas>
                    </div>
                </div>
                
                <!-- Success Rate Chart -->
                <div class="bg-white rounded-lg p-6 shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</h3>
                    <div class="relative h-64">
                        <canvas id="successRateChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Projects List -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="projectsList" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Export Modal -->
    <div id="pdfModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF</h3>
                        <button onclick="closePDFModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="generateSummaryPDF()" class="pdf-item bg-blue-50 border-2 border-blue-200 rounded-lg p-4 text-center hover:bg-blue-100">
                                <div class="text-3xl mb-2">üìä</div>
                                <h4 class="font-semibold text-blue-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h4>
                                <p class="text-sm text-blue-600 mt-1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            </button>
                            
                            <button onclick="generateAllProjectsPDF()" class="pdf-item bg-green-50 border-2 border-green-200 rounded-lg p-4 text-center hover:bg-green-100">
                                <div class="text-3xl mb-2">üìã</div>
                                <h4 class="font-semibold text-green-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                                <p class="text-sm text-green-600 mt-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>
                            </button>
                            
                            <button onclick="generateDepartmentPDF()" class="pdf-item bg-purple-50 border-2 border-purple-200 rounded-lg p-4 text-center hover:bg-purple-100">
                                <div class="text-3xl mb-2">üè¢</div>
                                <h4 class="font-semibold text-purple-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</h4>
                                <p class="text-sm text-purple-600 mt-1">‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>
                            </button>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <h4 class="font-semibold mb-3">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)</h4>
                        <div id="pdfProjectsList" class="max-h-96 overflow-y-auto space-y-2">
                            <p class="text-gray-500 text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    <div id="formSection" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-900">‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>
                <p class="text-gray-600">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568</p>
                <p class="text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
            </div>

            <form id="projectForm" class="space-y-6">
                <!-- Section 1: Project Info -->
                <div class="bg-blue-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                            <input type="text" name="projectName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ù‡πà‡∏≤‡∏¢</label>
                            <select name="department" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡πà‡∏≤‡∏¢</option>
                                <option value="‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£">‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
                                <option value="‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                                <option value="‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Strategy -->
                <div class="bg-green-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-800">2. ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà</label>
                            <input type="text" name="strategy" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™‡∏û‡∏ê.‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà</label>
                            <input type="text" name="standard" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                </div>

                <!-- Section 3: Timeline & Responsible -->
                <div class="bg-yellow-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-800">3. ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</label>
                            <input type="text" name="timeline" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
                            <input type="text" name="responsible" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        </div>
                    </div>
                </div>

                <!-- Section 5: Results -->
                <div class="bg-purple-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800">5. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h3>
                    
                    <!-- 5.1 Factors -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.1 ‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢</h4>
                        
                        <!-- 5.1.1 Timeline -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.1 ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô" class="mr-2">
                                    <span>‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏ú‡∏ô" class="mr-2">
                                    <span>‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏ú‡∏ô" class="mr-2">
                                    <span>‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" class="mr-2">
                                    <span>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                                </label>
                            </div>
                        </div>

                        <!-- Budget -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.7 ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" name="budgetAllocated" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" name="budgetUsed" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" name="budgetRemaining" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5.2 Results -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.2 ‡∏î‡πâ‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h4>
                        
                        <!-- 5.2.1 Achievement -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.2.1 ‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="achievement" value="‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠" class="mr-2">
                                    <span>‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="achievement" value="‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠" class="mr-2">
                                    <span>‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="achievement" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå" class="mr-2">
                                    <span>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</span>
                                </label>
                            </div>
                            <textarea name="achievementDetail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." class="w-full px-3 py-2 border border-gray-300 rounded-md mt-2" rows="2"></textarea>
                        </div>

                        <!-- KPI Table -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</label>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (%)</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô (%)</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏™‡∏£‡∏∏‡∏õ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kpiTable">
                                        <tr>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <input type="text" name="kpi1" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà 1">
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <input type="number" name="target1" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <input type="number" name="result1" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <select name="summary1" class="w-full px-2 py-1 border-0 focus:ring-0">
                                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                                    <option value="‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                                                    <option value="‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                                                </select>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <button type="button" onclick="addKPIRow()" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î</button>
                            </div>
                        </div>
                    </div>

                    <!-- 5.4 Suggestions -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.4 ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</h4>
                        <textarea name="suggestions" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="4" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤..."></textarea>
                    </div>

                    <!-- 5.5 Summary -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.5 ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h4>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="finalResult" value="‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                <span>‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="finalResult" value="‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                <span>‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <input type="text" name="reporterName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" name="reportDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</label>
                        <div class="signature-pad rounded-lg p-4">
                            <canvas id="signatureCanvas" width="400" height="200" class="border-2 border-dashed border-gray-300 rounded cursor-crosshair"></canvas>
                        </div>
                        <div class="mt-2 space-x-2">
                            <button type="button" onclick="clearSignature()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                            <button type="button" onclick="saveSignature()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-6">
                    <button type="submit" id="submitBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
                        <span id="submitText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ Google Sheets</span>
                        <div id="submitSpinner" class="loading ml-2 hidden"></div>
                    </button>
                    <button type="button" onclick="generateSingleProjectPDF()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="instructionsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-3xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script</h3>
                        <button onclick="closeInstructions()" class="text-gray-500 hover:text-gray-700">&times;</button>
                    </div>
                    <div class="space-y-4 text-sm">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Apps Script:</h4>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://script.google.com" target="_blank" class="text-blue-600 underline">Google Apps Script</a></li>
                                <li>‡∏Ñ‡∏•‡∏¥‡∏Å "New Project"</li>
                                <li>‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏ß‡∏≤‡∏á</li>
                                <li>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç SPREADSHEET_ID ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</li>
                                <li>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</li>
                                <li>‡∏Ñ‡∏•‡∏¥‡∏Å "Deploy" > "New deployment"</li>
                                <li>Type: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Web app"</li>
                                <li>Execute as: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Me"</li>
                                <li>Who has access: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Anyone"</li>
                                <li>‡∏Ñ‡∏•‡∏¥‡∏Å "Deploy" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li>
                            </ol>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">‡πÇ‡∏Ñ‡πâ‡∏î Google Apps Script ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:</h4>
                            <div class="bg-gray-900 text-green-400 p-4 rounded text-xs overflow-x-auto font-mono">
                                <pre id="scriptCodeBlock">function doPost(e) {
  try {
    let data;
    
    // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å form
    if (e.parameter && Object.keys(e.parameter).length > 0) {
      data = {};
      for (let key in e.parameter) {
        if (e.parameter.hasOwnProperty(key)) {
          data[key] = e.parameter[key];
        }
      }
    } else if (e.postData && e.postData.contents) {
      data = JSON.parse(e.postData.contents);
    } else {
      throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤');
    }
    
    console.log('Received data:', data);
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ID ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Google Sheets ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID_HERE';
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = spreadsheet.getActiveSheet();
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ header ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (sheet.getLastRow() === 0) {
      const headers = [
        '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', '‡∏ù‡πà‡∏≤‡∏¢', '‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå', '‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', 
        '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÉ‡∏ä‡πâ', 
        '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå', '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå', '‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞', 
        '‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', '‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô'
      ];
      sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
    }
    
    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô sheet
    const rowData = [
      new Date().toLocaleString('th-TH', {timeZone: 'Asia/Bangkok'}),
      data.projectName || '',
      data.department || '',
      data.strategy || '',
      data.standard || '',
      data.timeline || '',
      data.responsible || '',
      data.timelineStatus || '',
      data.budgetAllocated || '',
      data.budgetUsed || '',
      data.budgetRemaining || '',
      data.achievement || '',
      data.achievementDetail || '',
      data.suggestions || '',
      data.finalResult || '',
      data.reporterName || '',
      data.reportDate || ''
    ];
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á sheet
    sheet.appendRow(rowData);
    const newRow = sheet.getLastRow();
    
    console.log('Data saved to row:', newRow);
    
    return ContentService
      .createTextOutput(JSON.stringify({
        success: true,
        message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        row: newRow,
        timestamp: new Date().toISOString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    console.error('Error in doPost:', error);
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  try {
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ID ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Google Sheets ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID_HERE';
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = spreadsheet.getActiveSheet();
    
    let data = [];
    if (sheet.getLastRow() > 0) {
      data = sheet.getDataRange().getValues();
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({
        success: true,
        data: data,
        rows: sheet.getLastRow(),
        timestamp: new Date().toISOString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    console.error('Error in doGet:', error);
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}</pre>
                            </div>
                            <button onclick="copyScriptCode()" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">
                                ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î
                            </button>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button onclick="closeInstructions()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isDrawing = false;
        let signatureData = null;
        let kpiCounter = 1;
        let isGoogleConnected = false;
        let departmentChart = null;
        let successRateChart = null;
        let allProjectsData = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSignaturePad();
            loadStoredConfig();
            document.querySelector('input[name="reportDate"]').value = new Date().toISOString().split('T')[0];
            showDashboard();
        });

        // Configuration functions
        function loadStoredConfig() {
            const storedUrl = localStorage.getItem('scriptUrl') || '';
            if (storedUrl) {
                document.getElementById('scriptUrl').value = storedUrl;
            }
        }

        function saveConfig() {
            const scriptUrl = document.getElementById('scriptUrl').value;
            localStorage.setItem('scriptUrl', scriptUrl);
        }

        async function testScriptConnection() {
            const scriptUrl = document.getElementById('scriptUrl').value;
            
            if (!scriptUrl) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Google Apps Script URL', 'error');
                return;
            }
            
            saveConfig();
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'loading');
            
            try {
                const response = await fetch(scriptUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success !== false) {
                        showStatus('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        isGoogleConnected = true;
                        document.getElementById('syncStatus').classList.remove('hidden');
                        syncFromSheets();
                    } else {
                        throw new Error(result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.log('Connection test error:', error);
                showStatus('‡∏≠‡∏≤‡∏à‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ (CORS ‡∏≠‡∏≤‡∏à‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)', 'warning');
                isGoogleConnected = true;
                document.getElementById('syncStatus').classList.remove('hidden');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('connectionStatus');
            const messageDiv = document.getElementById('statusMessage');
            
            statusDiv.classList.remove('hidden');
            messageDiv.textContent = message;
            
            statusDiv.classList.remove('bg-green-100', 'bg-red-100', 'bg-yellow-100', 'bg-blue-100');
            
            switch(type) {
                case 'success': statusDiv.classList.add('bg-green-100'); break;
                case 'error': statusDiv.classList.add('bg-red-100'); break;
                case 'loading': statusDiv.classList.add('bg-blue-100'); break;
                case 'warning': statusDiv.classList.add('bg-yellow-100'); break;
                default: statusDiv.classList.add('bg-yellow-100');
            }
            
            if (type !== 'error') {
                setTimeout(() => statusDiv.classList.add('hidden'), 5000);
            }
        }

        // Form data collection - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function collectFormData(formData) {
            const data = {};
            
            // Handle regular form fields
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Collect KPI data
            const kpiData = [];
            for (let i = 1; i <= kpiCounter; i++) {
                const kpi = data[`kpi${i}`];
                const target = data[`target${i}`];
                const result = data[`result${i}`];
                const summary = data[`summary${i}`];
                
                if (kpi && kpi.trim()) {
                    kpiData.push({
                        kpi: kpi,
                        target: target || 0,
                        result: result || 0,
                        summary: summary || ''
                    });
                }
            }
            data.kpiData = kpiData;
            
            return data;
        }

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç submitToGoogleScript
        async function submitToGoogleScript(data) {
            const scriptUrl = document.getElementById('scriptUrl').value;
            
            try {
                const params = new URLSearchParams();
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô URLSearchParams
                for (const key in data) {
                    if (data.hasOwnProperty(key)) {
                        if (Array.isArray(data[key])) {
                            params.append(key, JSON.stringify(data[key]));
                        } else if (typeof data[key] === 'object' && data[key] !== null) {
                            params.append(key, JSON.stringify(data[key]));
                        } else {
                            params.append(key, String(data[key] || ''));
                        }
                    }
                }
                
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: params.toString()
                });
                
                if (response.ok) {
                    const result = await response.text();
                    console.log('Response:', result);
                    
                    try {
                        const jsonResult = JSON.parse(result);
                        return jsonResult;
                    } catch (e) {
                        if (result.includes('success') || result.length === 0) {
                            return { success: true, message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' };
                        } else {
                            throw new Error('Response ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                        }
                    }
                } else {
                    throw new Error(`HTTP Error ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('Submit error:', error);
                throw error;
            }
        }

        // Form submission
        document.getElementById('projectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');
            
            // ‡πÅ‡∏™‡∏î‡∏á loading state
            submitBtn.disabled = true;
            submitText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            submitSpinner.classList.remove('hidden');
            
            try {
                const formData = new FormData(this);
                const data = collectFormData(formData);
                
                if (signatureData) {
                    data.signature = signatureData;
                }
                
                data.timestamp = new Date().toISOString();
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡∏Å‡πà‡∏≠‡∏ô
                saveToStorage(data);
                
                if (isGoogleConnected && document.getElementById('scriptUrl').value) {
                    try {
                        showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets...', 'loading');
                        
                        const result = await submitToGoogleScript(data);
                        
                        if (result.success !== false) {
                            showStatus('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                            
                            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                            document.getElementById('projectForm').reset();
                            clearSignature();
                            document.querySelector('input[name="reportDate"]').value = new Date().toISOString().split('T')[0];
                            
                            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                            setTimeout(() => {
                                syncFromSheets();
                            }, 1000);
                            
                        } else {
                            throw new Error(result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                        }
                        
                    } catch (error) {
                        console.error('Submit failed:', error);
                        showStatus('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß: ' + error.message, 'error');
                    }
                } else {
                    showStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    loadDashboardData();
                }
                
            } catch (error) {
                console.error('Form submission error:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            } finally {
                // ‡∏ã‡πà‡∏≠‡∏ô loading state
                submitBtn.disabled = false;
                submitText.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ Google Sheets';
                submitSpinner.classList.add('hidden');
            }
        });

        // Sync data from Google Sheets
        async function syncFromSheets() {
            const scriptUrl = document.getElementById('scriptUrl').value;
            
            if (!isGoogleConnected || !scriptUrl) {
                loadDashboardData();
                return;
            }
            
            try {
                const response = await fetch(scriptUrl);
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.success && result.data && result.data.length > 1) {
                        allProjectsData = result.data.slice(1).map((row, index) => ({
                            id: index + 1,
                            timestamp: row[0] || '',
                            projectName: row[1] || '',
                            department: row[2] || '',
                            strategy: row[3] || '',
                            standard: row[4] || '',
                            timeline: row[5] || '',
                            responsible: row[6] || '',
                            timelineStatus: row[7] || '',
                            budgetAllocated: row[8] || '',
                            budgetUsed: row[9] || '',
                            budgetRemaining: row[10] || '',
                            achievement: row[11] || '',
                            achievementDetail: row[12] || '',
                            suggestions: row[13] || '',
                            finalResult: row[14] || '',
                            reporterName: row[15] || '',
                            reportDate: row[16] || ''
                        }));
                        
                        updateDashboardWithData(allProjectsData);
                    } else {
                        allProjectsData = [];
                        updateDashboardWithData([]);
                    }
                }
            } catch (error) {
                console.error('Sync error:', error);
                loadDashboardData();
            }
        }

        function updateDashboardWithData(projects) {
            document.getElementById('totalProjects').textContent = projects.length;
            
            const successCount = projects.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
            const failedCount = projects.filter(p => p.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
            const pendingCount = projects.filter(p => !p.finalResult || p.finalResult === '').length;
            
            document.getElementById('successProjects').textContent = successCount;
            document.getElementById('failedProjects').textContent = failedCount;
            document.getElementById('pendingProjects').textContent = pendingCount;
            
            updateCharts(projects);
            
            const projectsList = document.getElementById('projectsList');
            if (projects.length === 0) {
                projectsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>';
            } else {
                projectsList.innerHTML = projects.slice(-5).reverse().map(project => `
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-medium text-gray-900">${project.projectName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£'}</h4>
                                <p class="text-sm text-gray-600">‡∏ù‡πà‡∏≤‡∏¢: ${project.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                <p class="text-sm text-gray-600">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ${project.responsible || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                    project.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? 'bg-green-100 text-green-800' :
                                    project.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? 'bg-red-100 text-red-800' :
                                    'bg-yellow-100 text-yellow-800'
                                }">
                                    ${project.finalResult || '‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'}
                                </span>
                                <p class="text-xs text-gray-500 mt-1">${project.timestamp || project.reportDate}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateCharts(projects) {
            const departmentData = {};
            const departmentSuccess = {};
            
            const departments = ['‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'];
            departments.forEach(dept => {
                departmentData[dept] = 0;
                departmentSuccess[dept] = { success: 0, total: 0 };
            });
            
            projects.forEach(project => {
                const dept = project.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!departmentData[dept]) {
                    departmentData[dept] = 0;
                    departmentSuccess[dept] = { success: 0, total: 0 };
                }
                
                departmentData[dept]++;
                departmentSuccess[dept].total++;
                
                if (project.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢') {
                    departmentSuccess[dept].success++;
                }
            });
            
            createDepartmentChart(departmentData);
            createSuccessRateChart(departmentSuccess);
        }

        function createDepartmentChart(data) {
            const ctx = document.getElementById('departmentChart').getContext('2d');
            
            if (departmentChart) {
                departmentChart.destroy();
            }
            
            const labels = Object.keys(data);
            const values = Object.values(data);
            const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#06B6D4'];
            
            departmentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: { family: 'Sarabun', size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const deptIndex = context.dataIndex;
                                    const dept = labels[deptIndex];
                                    const rate = context.parsed.y;
                                    const total = totalProjects[deptIndex];
                                    const success = data[dept].success;
                                    return [`‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${rate}%`, `‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${success}/${total}`];
                                }
                            },
                            titleFont: { family: 'Sarabun' },
                            bodyFont: { family: 'Sarabun' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) { return value + '%'; },
                                font: { family: 'Sarabun' }
                            }
                        },
                        x: {
                            ticks: { font: { family: 'Sarabun' } }
                        }
                    }
                }
            });
        }

        // Navigation functions
        function showDashboard() {
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('formSection').classList.add('hidden');
            if (isGoogleConnected) {
                syncFromSheets();
            } else {
                loadDashboardData();
            }
        }

        function showForm() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('formSection').classList.remove('hidden');
        }

        function toggleConfig() {
            const panel = document.getElementById('configPanel');
            panel.classList.toggle('hidden');
        }

        // Storage functions (fallback)
        function saveToStorage(data) {
            let projects = JSON.parse(localStorage.getItem('projects') || '[]');
            projects.push(data);
            localStorage.setItem('projects', JSON.stringify(projects));
        }

        function loadDashboardData() {
            const projects = JSON.parse(localStorage.getItem('projects') || '[]');
            allProjectsData = projects.map((project, index) => ({ ...project, id: index + 1 }));
            updateDashboardWithData(allProjectsData);
        }

        // Signature pad functions
        function initializeSignaturePad() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }

            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000';
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            }

            function stopDrawing() {
                isDrawing = false;
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                 e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        function clearSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            signatureData = null;
        }

        function saveSignature() {
            const canvas = document.getElementById('signatureCanvas');
            signatureData = canvas.toDataURL();
            alert('‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
        }

        // KPI table functions
        function addKPIRow() {
            kpiCounter++;
            const table = document.getElementById('kpiTable');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="border border-gray-300 px-4 py-2">
                    <input type="text" name="kpi${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà ${kpiCounter}">
                </td>
                <td class="border border-gray-300 px-4 py-2">
                    <input type="number" name="target${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                </td>
                <td class="border border-gray-300 px-4 py-2">
                    <input type="number" name="result${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                </td>
                <td class="border border-gray-300 px-4 py-2">
                    <select name="summary${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                        <option value="‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                        <option value="‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                    </select>
                </td>
            `;
            table.appendChild(row);
        }

        // PDF Functions
        function showPDFExports() {
            updatePDFProjectsList();
            document.getElementById('pdfModal').classList.remove('hidden');
        }

        function closePDFModal() {
            document.getElementById('pdfModal').classList.add('hidden');
        }

        function updatePDFProjectsList() {
            const pdfProjectsList = document.getElementById('pdfProjectsList');
            if (allProjectsData.length === 0) {
                pdfProjectsList.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>';
            } else {
                pdfProjectsList.innerHTML = allProjectsData.map(project => `
                    <div class="pdf-item bg-gray-50 border border-gray-200 rounded-lg p-3 hover:bg-gray-100 cursor-pointer" 
                         onclick="generateProjectPDF(${project.id})">
                        <div class="flex justify-between items-center">
                            <div>
                                <h5 class="font-medium text-gray-900">${project.projectName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£'}</h5>
                                <p class="text-xs text-gray-600">‡∏ù‡πà‡∏≤‡∏¢: ${project.department} | ‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${project.reporterName}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-xs px-2 py-1 rounded ${
                                    project.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? 'bg-green-100 text-green-700' :
                                    project.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? 'bg-red-100 text-red-700' :
                                    'bg-yellow-100 text-yellow-700'
                                }">
                                    ${project.finalResult || '‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'}
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // PDF Generation Functions - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        function generateSummaryPDF() {
            try {
                createPDFFromHTML('summary');
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF: ' + error.message);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏à‡∏≤‡∏Å HTML
        function createPDFFromHTML(type, data = null) {
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = `
                position: absolute;
                left: -9999px;
                top: -9999px;
                width: 794px;
                padding: 40px;
                font-family: 'Sarabun', sans-serif;
                background: white;
                font-size: 14px;
                line-height: 1.6;
                color: black;
            `;

            let content = '';
            let filename = '';

            switch(type) {
                case 'summary':
                    content = generateSummaryHTML();
                    filename = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°_${new Date().toISOString().split('T')[0]}.pdf`;
                    break;
                case 'allprojects':
                    content = generateAllProjectsHTML();
                    filename = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î_${new Date().toISOString().split('T')[0]}.pdf`;
                    break;
                case 'department':
                    content = generateDepartmentHTML();
                    filename = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢_${new Date().toISOString().split('T')[0]}.pdf`;
                    break;
                case 'single':
                    content = generateSingleProjectHTML(data);
                    filename = `‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£_${(data?.projectName || '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£').replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                    break;
                case 'project':
                    content = generateProjectHTML(data);
                    filename = `‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£_${(data?.projectName || '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£').replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g, '_')}.pdf`;
                    break;
            }

            tempDiv.innerHTML = content;
            document.body.appendChild(tempDiv);

            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÇ‡∏´‡∏•‡∏î
            setTimeout(() => {
                html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: tempDiv.offsetWidth,
                    height: tempDiv.scrollHeight
                }).then(canvas => {
                    document.body.removeChild(tempDiv);
                    
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 295; // A4 height in mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save(filename);
                }).catch(error => {
                    document.body.removeChild(tempDiv);
                    console.error('Canvas error:', error);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF: ' + error.message);
                });
            }, 500);
        }

        function generateSummaryHTML() {
            const totalProjects = allProjectsData.length;
            const successCount = allProjectsData.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
            const failedCount = allProjectsData.filter(p => p.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
            const pendingCount = allProjectsData.filter(p => !p.finalResult).length;

            return `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #3b82f6; padding-bottom: 20px;">
                    <h1 style="font-size: 28px; font-weight: bold; margin-bottom: 10px; color: #1e40af;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h1>
                    <h2 style="font-size: 20px; margin-bottom: 5px; color: #3730a3;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</h2>
                    <p style="font-size: 18px; color: #6366f1;">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568</p>
                </div>
                
                <div style="margin-bottom: 40px;">
                    <h3 style="font-size: 22px; font-weight: bold; margin-bottom: 20px; color: #059669; border-left: 5px solid #059669; padding-left: 15px;">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: linear-gradient(135deg, #3b82f6, #1e40af); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <p style="margin: 8px 0; font-size: 16px;"><strong>üìã ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${totalProjects} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
                            <p style="margin: 8px 0; font-size: 16px;"><strong>‚úÖ ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ${successCount} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <p style="margin: 8px 0; font-size: 16px;"><strong>‚ùå ‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ${failedCount} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
                            <p style="margin: 8px 0; font-size: 16px;"><strong>‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</strong> ${pendingCount} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 40px;">
                    <h3 style="font-size: 22px; font-weight: bold; margin-bottom: 20px; color: #dc2626; border-left: 5px solid #dc2626; padding-left: 15px;">üè¢ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</h3>
                    ${['‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'].map(dept => {
                        const deptProjects = allProjectsData.filter(p => p.department === dept);
                        const successCount = deptProjects.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
                        const successRate = deptProjects.length > 0 ? ((successCount / deptProjects.length) * 100).toFixed(1) : 0;
                        
                        return `
                            <div style="background: #f8fafc; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #3b82f6;">
                                <p style="margin: 0; font-size: 16px;"><strong>‡∏ù‡πà‡∏≤‡∏¢${dept}:</strong> ${deptProjects.length} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successRate}%)</p>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                ${allProjectsData.length > 0 ? `
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 22px; font-weight: bold; margin-bottom: 20px; color: #7c3aed; border-left: 5px solid #7c3aed; padding-left: 15px;">üìù ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                        ${allProjectsData.slice(-5).reverse().map((project, index) => `
                            <div style="background: #faf5ff; padding: 18px; margin-bottom: 12px; border-radius: 8px; border-left: 5px solid #7c3aed;">
                                <h4 style="font-weight: bold; margin-bottom: 10px; font-size: 16px; color: #581c87;">${index + 1}. ${project.projectName}</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <p style="margin: 4px 0;"><strong>‡∏ù‡πà‡∏≤‡∏¢:</strong> ${project.department}</p>
                                    <p style="margin: 4px 0;"><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ${project.responsible}</p>
                                </div>
                                <p style="margin: 4px 0;"><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span style="color: ${project.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? '#059669' : project.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? '#dc2626' : '#d97706'};">${project.finalResult || '‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'}</span></p>
                                <p style="margin: 4px 0; font-size: 12px; color: #6b7280;"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${project.reportDate}</p>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                <div style="margin-top: 60px; text-align: center; font-size: 12px; color: #6b7280; border-top: 2px solid #e5e7eb; padding-top: 20px;">
                    <p>üïí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}</p>
                    <p>üìß ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
                </div>
            `;
        }

        function generateSingleProjectHTML(data) {
            return `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #3b82f6; padding-bottom: 20px;">
                    <h1 style="font-size: 26px; font-weight: bold; margin-bottom: 10px; color: #1e40af;">‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h1>
                    <h2 style="font-size: 18px; margin-bottom: 5px; color: #3730a3;">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡¶£ 2568</h2>
                    <p style="font-size: 16px; color: #6366f1;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
                </div>
                
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ -->
                <div style="margin-bottom: 30px;">
                    <div style="background: #3b82f6; color: white; padding: 18px; border-radius: 8px; margin-bottom: 20px;">
                        <h2 style="font-size: 20px; font-weight: bold; margin: 0;">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 25px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                            <div>
                                <p style="margin: 10px 0; font-size: 15px;"><strong>üìù ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</strong><br><span style="font-size: 16px; color: #1e40af;">${data.projectName || '-'}</span></p>
                                <p style="margin: 10px 0;"><strong>üè¢ ‡∏ù‡πà‡∏≤‡∏¢:</strong> ${data.department || '-'}</p>
                                <p style="margin: 10px 0;"><strong>üéØ ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà:</strong> ${data.strategy || '-'}</p>
                            </div>
                            <div>
                                <p style="margin: 10px 0;"><strong>üìã ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™‡∏û‡∏ê.:</strong> ${data.standard || '-'}</p>
                                <p style="margin: 10px 0;"><strong>‚è∞ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô:</strong> ${data.timeline || '-'}</p>
                                <p style="margin: 10px 0;"><strong>üë§ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ${data.responsible || '-'}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô -->
                <div style="margin-bottom: 30px;">
                    <div style="background: #059669; color: white; padding: 18px; border-radius: 8px; margin-bottom: 20px;">
                        <h2 style="font-size: 20px; font-weight: bold; margin: 0;">5. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h2>
                    </div>
                    
                    <!-- 5.1 ‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢ -->
                    <div style="background: #f0fdf4; padding: 25px; border-radius: 8px; border: 1px solid #bbf7d0; margin-bottom: 25px;">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #065f46;">5.1 ‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <p style="margin: 8px 0;"><strong>‚è±Ô∏è ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</strong> ${data.timelineStatus || '-'}</p>
                            </div>
                            <div>
                                <p style="margin: 8px 0;"><strong>ü§ù ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠:</strong> ${data.cooperation || '-'}</p>
                            </div>
                        </div>
                        
                        <!-- ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì -->
                        ${(data.budgetAllocated || data.budgetUsed || data.budgetRemaining) ? `
                            <div style="background: white; padding: 18px; border-radius: 6px; margin-top: 20px;">
                                <h4 style="font-weight: bold; margin-bottom: 12px;">üí∞ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                                    <p style="margin: 0;"><strong>üíµ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£:</strong> ${data.budgetAllocated || 0} ‡∏ö‡∏≤‡∏ó</p>
                                    <p style="margin: 0;"><strong>üí∏ ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ:</strong> ${data.budgetUsed || 0} ‡∏ö‡∏≤‡∏ó</p>
                                    <p style="margin: 0;"><strong>üí∞ ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</strong> ${data.budgetRemaining || 0} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- 5.2 ‡∏î‡πâ‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô -->
                    <div style="background: #fef3c7; padding: 25px; border-radius: 8px; border: 1px solid #fcd34d; margin-bottom: 25px;">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #92400e;">5.2 ‡∏î‡πâ‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <p style="margin: 10px 0;"><strong>üéØ ‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå:</strong> ${data.achievement || '-'}</p>
                            ${data.achievementDetail ? `<div style="background: white; padding: 12px; border-radius: 4px; margin: 10px 0;"><p style="margin: 0;"><strong>üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${data.achievementDetail}</p></div>` : ''}
                        </div>
                        
                        <!-- KPI -->
                        ${data.kpiData && data.kpiData.length > 0 ? `
                            <div style="background: white; padding: 18px; border-radius: 6px;">
                                <h4 style="font-weight: bold; margin-bottom: 12px;">üéØ ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:</h4>
                                ${data.kpiData.map(kpi => `
                                    <div style="background: #f3f4f6; padding: 10px; margin-bottom: 8px; border-radius: 4px; border-left: 4px solid ${kpi.summary === '‡∏ö‡∏£‡∏£‡∏•‡∏∏' ? '#10b981' : '#ef4444'};">
                                        <p style="margin: 0;"><strong>${kpi.kpi}:</strong> ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ${kpi.target}%, ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ${kpi.result}% (${kpi.summary})</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ -->
                    ${data.suggestions ? `
                        <div style="background: #f0f9ff; padding: 25px; border-radius: 8px; border: 1px solid #bae6fd; margin-bottom: 25px;">
                            <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #0c4a6e;">5.4 ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</h3>
                            <div style="background: white; padding: 18px; border-radius: 6px;">
                                <p style="margin: 0;">${data.suggestions}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô -->
                    <div style="background: #f3e8ff; padding: 25px; border-radius: 8px; border: 1px solid #c4b5fd;">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #581c87;">5.5 ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h3>
                        <div style="background: white; padding: 18px; border-radius: 6px; text-align: center;">
                            <p style="font-size: 22px; font-weight: bold; margin: 0; color: ${data.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? '#059669' : data.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? '#dc2626' : '#d97706'};">
                                ${data.finalResult || '‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'}
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô -->
                <div style="border-top: 2px solid #e5e7eb; padding-top: 25px; margin-top: 40px;">
                    <div style="background: #f8fafc; padding: 25px; border-radius: 8px;">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 18px;">‚úçÔ∏è ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                            <p style="margin: 0;"><strong>üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:</strong> ${data.reporterName || '-'}</p>
                            <p style="margin: 0;"><strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${data.reportDate || '-'}</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 60px; text-align: center; font-size: 12px; color: #6b7280; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                    <p>üïí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}</p>
                </div>
            `;
        }
                
                // Statistics
                const totalProjects = allProjectsData.length;
                const successCount = allProjectsData.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
                const failedCount = allProjectsData.filter(p => p.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
                const pendingCount = allProjectsData.filter(p => !p.finalResult || p.finalResult === '').length;

                pdf.setFontSize(12);
                pdf.text(`Total Projects: ${totalProjects}`, 20, 50);
                pdf.text(`Successful: ${successCount}`, 20, 60);
                pdf.text(`Failed: ${failedCount}`, 20, 70);
                pdf.text(`Pending: ${pendingCount}`, 20, 80);

                // Department stats
                const departments = ['‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'];
                let yPos = 100;
                departments.forEach(dept => {
                    const deptProjects = allProjectsData.filter(p => p.department === dept);
                    const deptSuccess = deptProjects.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
                    const successRate = deptProjects.length > 0 ? ((deptSuccess / deptProjects.length) * 100).toFixed(1) : 0;
                    
                    pdf.text(`${dept}: ${deptProjects.length} projects (${successRate}% success)`, 20, yPos);
                    yPos += 10;
                });

                // Recent projects
                if (allProjectsData.length > 0) {
                    pdf.text('Recent Projects:', 20, yPos + 20);
                    yPos += 30;
                    
                    const recentProjects = allProjectsData.slice(-5).reverse();
                    recentProjects.forEach((project, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        
                        pdf.text(`${index + 1}. ${project.projectName || 'Untitled'}`, 20, yPos);
                        yPos += 10;
                        pdf.text(`   Department: ${project.department || 'N/A'}`, 20, yPos);
                        yPos += 10;
                        pdf.text(`   Status: ${project.finalResult || 'Pending'}`, 20, yPos);
                        yPos += 15;
                    });
                }

                pdf.setFontSize(8);
                pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, 280);
                pdf.save(`summary_report_${new Date().toISOString().split('T')[0]}.pdf`);

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        function generateAllProjectsPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                if (allProjectsData.length === 0) {
                    alert('No project data to export');
                    return;
                }

                pdf.setFont('helvetica');
                pdf.setFontSize(16);
                pdf.text('All Projects Report', 20, 20);
                pdf.text('Sa School, Wiang Sa District, Nan Province', 20, 30);
                
                let yPosition = 50;

                allProjectsData.forEach((project, index) => {
                    if (yPosition > 250) {
                        pdf.addPage();
                        yPosition = 20;
                    }

                    pdf.setFontSize(12);
                    pdf.text(`${index + 1}. ${project.projectName || 'Untitled Project'}`, 20, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(10);
                    pdf.text(`Department: ${project.department || 'N/A'}`, 25, yPosition);
                    yPosition += 6;
                    pdf.text(`Responsible: ${project.responsible || 'N/A'}`, 25, yPosition);
                    yPosition += 6;
                    pdf.text(`Timeline: ${project.timeline || 'N/A'}`, 25, yPosition);
                    yPosition += 6;
                    pdf.text(`Result: ${project.finalResult || 'Pending'}`, 25, yPosition);
                    yPosition += 6;
                    pdf.text(`Reporter: ${project.reporterName || 'N/A'}`, 25, yPosition);
                    yPosition += 6;
                    pdf.text(`Date: ${project.reportDate || 'N/A'}`, 25, yPosition);
                    yPosition += 12;

                    if (project.suggestions && project.suggestions.trim()) {
                        pdf.text(`Suggestions: ${project.suggestions.substring(0, 100)}${project.suggestions.length > 100 ? '...' : ''}`, 25, yPosition);
                        yPosition += 10;
                    }
                });

                pdf.setFontSize(8);
                pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, 280);
                pdf.save(`all_projects_${new Date().toISOString().split('T')[0]}.pdf`);

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        function generateDepartmentPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                pdf.setFont('helvetica');
                pdf.setFontSize(16);
                pdf.text('Department Report', 20, 20);
                pdf.text('Sa School, Wiang Sa District, Nan Province', 20, 30);

                const departments = ['‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'];
                let yPosition = 50;

                departments.forEach(dept => {
                    const deptProjects = allProjectsData.filter(p => p.department === dept);
                    const successCount = deptProjects.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
                    const successRate = deptProjects.length > 0 ? ((successCount / deptProjects.length) * 100).toFixed(1) : 0;

                    if (yPosition > 240) {
                        pdf.addPage();
                        yPosition = 20;
                    }

                    pdf.setFontSize(14);
                    pdf.text(`Department: ${dept}`, 20, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.text(`Projects: ${deptProjects.length} | Success Rate: ${successRate}%`, 25, yPosition);
                    yPosition += 12;

                    if (deptProjects.length === 0) {
                        pdf.text('No projects in this department', 25, yPosition);
                        yPosition += 15;
                    } else {
                        deptProjects.forEach((project, index) => {
                            if (yPosition > 260) {
                                pdf.addPage();
                                yPosition = 20;
                            }

                            pdf.setFontSize(10);
                            pdf.text(`${index + 1}. ${project.projectName}`, 30, yPosition);
                            yPosition += 6;
                            pdf.text(`   Responsible: ${project.responsible || 'N/A'}`, 35, yPosition);
                            yPosition += 6;
                            pdf.text(`   Status: ${project.finalResult || 'Pending'}`, 35, yPosition);
                            yPosition += 8;
                        });
                    }
                    yPosition += 10;
                });

                pdf.setFontSize(8);
                pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, 280);
                pdf.save(`department_report_${new Date().toISOString().split('T')[0]}.pdf`);

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        function generateSingleProjectPDF() {
            try {
                const formData = new FormData(document.getElementById('projectForm'));
                const data = collectFormData(formData);
                
                if (!data.projectName || !data.projectName.trim()) {
                    alert('Please enter project name before exporting PDF');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                pdf.setFont('helvetica');
                pdf.setFontSize(16);
                pdf.text('Project Evaluation Form', 20, 20);
                pdf.text('Fiscal Year 2568', 20, 30);
                pdf.text('Sa School, Wiang Sa District, Nan Province', 20, 40);

                let yPosition = 60;

                // Project Info
                pdf.setFontSize(12);
                pdf.text('1. Project Information', 20, yPosition);
                yPosition += 10;

                pdf.setFontSize(10);
                pdf.text(`Project Name: ${data.projectName}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Department: ${data.department || 'N/A'}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Strategy: ${data.strategy || 'N/A'}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Standard: ${data.standard || 'N/A'}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Timeline: ${data.timeline || 'N/A'}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Responsible: ${data.responsible || 'N/A'}`, 25, yPosition);
                yPosition += 15;

                // Results
                pdf.setFontSize(12);
                pdf.text('5. Results', 20, yPosition);
                yPosition += 10;

                pdf.setFontSize(10);
                if (data.timelineStatus) {
                    pdf.text(`Timeline Status: ${data.timelineStatus}`, 25, yPosition);
                    yPosition += 6;
                }
                if (data.budgetAllocated || data.budgetUsed) {
                    pdf.text(`Budget: Allocated ${data.budgetAllocated || 0}, Used ${data.budgetUsed || 0}, Remaining ${data.budgetRemaining || 0}`, 25, yPosition);
                    yPosition += 6;
                }
                if (data.achievement) {
                    pdf.text(`Achievement: ${data.achievement}`, 25, yPosition);
                    yPosition += 6;
                }
                if (data.achievementDetail) {
                    const lines = pdf.splitTextToSize(`Details: ${data.achievementDetail}`, 160);
                    lines.forEach(line => {
                        if (yPosition > 270) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        pdf.text(line, 25, yPosition);
                        yPosition += 6;
                    });
                }

                // KPI
                if (data.kpiData && data.kpiData.length > 0) {
                    yPosition += 5;
                    pdf.text('KPIs:', 25, yPosition);
                    yPosition += 6;
                    data.kpiData.forEach(kpi => {
                        if (yPosition > 270) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        pdf.text(`- ${kpi.kpi}: Target ${kpi.target}%, Result ${kpi.result}% (${kpi.summary})`, 30, yPosition);
                        yPosition += 6;
                    });
                }

                // Suggestions
                if (data.suggestions && data.suggestions.trim()) {
                    if (yPosition > 250) {
                        pdf.addPage();
                        yPosition = 20;
                    }
                    yPosition += 10;
                    pdf.text('Suggestions:', 25, yPosition);
                    yPosition += 6;
                    
                    const lines = pdf.splitTextToSize(data.suggestions, 160);
                    lines.forEach(line => {
                        if (yPosition > 270) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        pdf.text(line, 25, yPosition);
                        yPosition += 6;
                    });
                }

                // Final Result
                if (data.finalResult) {
                    yPosition += 10;
                    pdf.setFontSize(12);
                    pdf.text('Final Result:', 25, yPosition);
                    yPosition += 8;
                    pdf.setFontSize(10);
                    pdf.text(data.finalResult, 25, yPosition);
                }

                // Reporter
                yPosition += 15;
                if (yPosition > 250) {
                    pdf.addPage();
                    yPosition = 20;
                }
                pdf.text('Reporter Information:', 25, yPosition);
                yPosition += 8;
                pdf.text(`Name: ${data.reporterName || 'N/A'}`, 30, yPosition);
                yPosition += 6;
                pdf.text(`Date: ${data.reportDate || 'N/A'}`, 30, yPosition);

                pdf.setFontSize(8);
                pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, 285);

                const fileName = `project_evaluation_${data.projectName.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        function generateProjectPDF(projectId) {
            try {
                const project = allProjectsData.find(p => p.id === projectId);
                if (!project) {
                    alert('Project not found');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                pdf.setFont('helvetica');
                pdf.setFontSize(16);
                pdf.text('Project Evaluation Report', 20, 20);
                pdf.text('Sa School, Wiang Sa District, Nan Province', 20, 30);

                let yPosition = 50;

                // Project Info
                pdf.setFontSize(12);
                pdf.text('Project Information', 20, yPosition);
                yPosition += 10;

                pdf.setFontSize(10);
                pdf.text(`Project Name: ${project.projectName}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Department: ${project.department || 'N/A'}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Timeline: ${project.timeline || 'N/A'}`, 25, yPosition);
                yPosition += 6;
                pdf.text(`Responsible: ${project.responsible || 'N/A'}`, 25, yPosition);
                yPosition += 15;

                // Results
                pdf.setFontSize(12);
                pdf.text('Results', 20, yPosition);
                yPosition += 10;

                pdf.setFontSize(10);
                if (project.achievement) {
                    pdf.text(`Achievement: ${project.achievement}`, 25, yPosition);
                    yPosition += 6;
                }
                if (project.finalResult) {
                    pdf.text(`Final Result: ${project.finalResult}`, 25, yPosition);
                    yPosition += 6;
                }

                // Suggestions
                if (project.suggestions) {
                    yPosition += 10;
                    pdf.text('Suggestions:', 25, yPosition);
                    yPosition += 6;
                    const lines = pdf.splitTextToSize(project.suggestions, 160);
                    lines.forEach(line => {
                        if (yPosition > 270) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        pdf.text(line, 25, yPosition);
                        yPosition += 6;
                    });
                }

                // Reporter
                yPosition += 15;
                pdf.text('Reporter Information:', 25, yPosition);
                yPosition += 8;
                pdf.text(`Name: ${project.reporterName || 'N/A'}`, 30, yPosition);
                yPosition += 6;
                pdf.text(`Date: ${project.reportDate || 'N/A'}`, 30, yPosition);

                pdf.setFontSize(8);
                pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, 285);

                const fileName = `project_${project.projectName.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
                pdf.save(fileName);

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        // Instructions and helper functions
        function showScriptInstructions() {
            document.getElementById('instructionsModal').classList.remove('hidden');
        }

        function closeInstructions() {
            document.getElementById('instructionsModal').classList.add('hidden');
        }

        function copyScriptCode() {
            const scriptCode = document.getElementById('scriptCodeBlock').textContent;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(scriptCode).then(() => {
                    alert('Code copied successfully!\n\nNext steps:\n1. Go to script.google.com\n2. Create new project\n3. Paste the copied code\n4. Change SPREADSHEET_ID\n5. Deploy as Web app');
                }).catch(() => {
                    fallbackCopy(scriptCode);
                });
            } else {
                fallbackCopy(scriptCode);
            }
            
            function fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('Code copied successfully!');
                } catch (err) {
                    alert('Cannot copy automatically\nPlease copy the code manually');
                }
                document.body.removeChild(textArea);
            }
        }
    </script>
</body>
</html>: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (${percentage}%)`;
                                }
                            },
                            titleFont: { family: 'Sarabun' },
                            bodyFont: { family: 'Sarabun' }
                        }
                    }
                }
            });
        }

        function createSuccessRateChart(data) {
            const ctx = document.getElementById('successRateChart').getContext('2d');
            
            if (successRateChart) {
                successRateChart.destroy();
            }
            
            const labels = Object.keys(data);
            const successRates = labels.map(dept => {
                const deptData = data[dept];
                return deptData.total > 0 ? ((deptData.success / deptData.total) * 100).toFixed(1) : 0;
            });
            const totalProjects = labels.map(dept => data[dept].total);
            
            successRateChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (%)',
                        data: successRates,
                        backgroundColor: ['rgba(59, 130, 246, 0.8)', 'rgba(16, 185, 129, 0.8)', 'rgba(245, 158, 11, 0.8)', 'rgba(239, 68, 68, 0.8)'],
                        borderColor: ['rgba(59, 130, 246, 1)', 'rgba(16, 185, 129, 1)', 'rgba(245, 158, 11, 1)', 'rgba(239, 68, 68, 1)'],
                        borderWidth: 2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label
