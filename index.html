<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .signature-pad { border: 2px dashed #d1d5db; background: #f9fafb; }
        .signature-pad canvas { display: block; }
        @media print {
            .no-print { display: none !important; }
            body { font-size: 12px; }
        }
        .config-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Google Sheets Configuration Panel -->
    <div id="configPanel" class="config-panel text-white p-6 mb-6">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-xl font-bold mb-4">üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets API</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Google Sheets ID</label>
                    <input type="text" id="sheetsId" class="w-full px-3 py-2 rounded-md text-gray-900" 
                           placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                    <p class="text-xs mt-1 opacity-80">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL ‡∏Ç‡∏≠‡∏á Google Sheets</p>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">API Key</label>
                    <input type="password" id="apiKey" class="w-full px-3 py-2 rounded-md text-gray-900" 
                           placeholder="AIzaSyC9DlzHH1qzVKDOQfJZgHpQQQQQQQQQQQQ">
                    <p class="text-xs mt-1 opacity-80">API Key ‡∏à‡∏≤‡∏Å Google Cloud Console</p>
                </div>
            </div>
            <div class="flex gap-4 mt-4">
                <button onclick="testConnection()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-md transition-colors">
                    üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
                <button onclick="createSheetsTemplate()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md transition-colors">
                    üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï
                </button>
                <button onclick="toggleConfig()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-md transition-colors">
                    ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>
            <div id="connectionStatus" class="mt-4 p-3 rounded-md bg-black bg-opacity-20 hidden">
                <p id="statusMessage"></p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">üè´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h1>
                        <p class="text-sm text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="syncStatus" class="text-sm text-gray-600 hidden">
                        <span class="inline-flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets
                        </span>
                    </div>
                    <button onclick="showDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button onclick="showForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        üìù ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <div id="dashboard" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                <button onclick="syncFromSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                    üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-blue-100">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p class="text-3xl font-bold" id="totalProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üìã</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-green-100">‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
                            <p class="text-3xl font-bold" id="successProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚úÖ</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-yellow-100">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                            <p class="text-3xl font-bold" id="pendingProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚è≥</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-red-100">‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
                            <p class="text-3xl font-bold" id="failedProjects">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚ùå</div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Department Chart -->
                <div class="bg-white rounded-lg p-6 shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</h3>
                    <div class="relative h-64">
                        <canvas id="departmentChart"></canvas>
                    </div>
                </div>
                
                <!-- Success Rate Chart -->
                <div class="bg-white rounded-lg p-6 shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</h3>
                    <div class="relative h-64">
                        <canvas id="successRateChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Projects List -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="projectsList" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    <div id="formSection" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-900">‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>
                <p class="text-gray-600">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568</p>
                <p class="text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
            </div>

            <form id="projectForm" class="space-y-6">
                <!-- Section 1: Project Info -->
                <div class="bg-blue-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                            <input type="text" name="projectName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ù‡πà‡∏≤‡∏¢</label>
                            <select name="department" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡πà‡∏≤‡∏¢</option>
                                <option value="‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£">‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
                                <option value="‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                                <option value="‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Strategy -->
                <div class="bg-green-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-800">2. ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà</label>
                            <input type="text" name="strategy" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™‡∏û‡∏ê.‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà</label>
                            <input type="text" name="standard" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                </div>

                <!-- Section 3: Timeline & Responsible -->
                <div class="bg-yellow-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-800">3. ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</label>
                            <input type="text" name="timeline" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
                            <input type="text" name="responsible" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        </div>
                    </div>
                </div>

                <!-- Section 5: Results -->
                <div class="bg-purple-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800">5. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h3>
                    
                    <!-- 5.1 Factors -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.1 ‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢</h4>
                        
                        <!-- 5.1.1 Timeline -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.1 ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô" class="mr-2">
                                    <span>‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏ú‡∏ô" class="mr-2">
                                    <span>‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏ú‡∏ô" class="mr-2">
                                    <span>‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timelineStatus" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" class="mr-2">
                                    <span>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                                </label>
                            </div>
                        </div>

                        <!-- 5.1.2 Location -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.2 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="locationSuitability" value="‡∏°‡∏≤‡∏Å" class="mr-2">
                                    <span>‡∏°‡∏≤‡∏Å</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="locationSuitability" value="‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á" class="mr-2">
                                    <span>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="locationSuitability" value="‡∏ô‡πâ‡∏≠‡∏¢" class="mr-2">
                                    <span>‡∏ô‡πâ‡∏≠‡∏¢</span>
                                </label>
                            </div>
                        </div>

                        <!-- 5.1.3 Equipment Quantity -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.3 ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="equipmentQuantity" value="‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠" class="mr-2">
                                    <span>‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="equipmentQuantity" value="‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠" class="mr-2">
                                    <span>‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</span>
                                </label>
                            </div>
                            <input type="text" name="missingEquipment" placeholder="‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏∑‡∏≠..." class="w-full px-3 py-2 border border-gray-300 rounded-md mt-2">
                        </div>

                        <!-- 5.1.4 Equipment Quality -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.4 ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="equipmentQuality" value="‡∏î‡∏µ‡∏°‡∏≤‡∏Å" class="mr-2">
                                    <span>‡∏î‡∏µ‡∏°‡∏≤‡∏Å</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="equipmentQuality" value="‡∏û‡∏≠‡πÉ‡∏ä‡πâ" class="mr-2">
                                    <span>‡∏û‡∏≠‡πÉ‡∏ä‡πâ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="equipmentQuality" value="‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á" class="mr-2">
                                    <span>‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</span>
                                </label>
                            </div>
                        </div>

                        <!-- 5.1.5 Personnel -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.5 ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="personnelQuantity" value="‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ" class="mr-2">
                                    <span>‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="personnelQuantity" value="‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠" class="mr-2">
                                    <span>‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="personnelQuantity" value="‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ" class="mr-2">
                                    <span>‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</span>
                                </label>
                            </div>
                        </div>

                        <!-- 5.1.6 Cooperation -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.6 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô/‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="cooperation" value="‡∏î‡∏µ‡∏°‡∏≤‡∏Å" class="mr-2">
                                    <span>‡∏î‡∏µ‡∏°‡∏≤‡∏Å</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="cooperation" value="‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£" class="mr-2">
                                    <span>‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="cooperation" value="‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ" class="mr-2">
                                    <span>‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</span>
                                </label>
                            </div>
                        </div>

                        <!-- 5.1.7 Budget -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.1.7 ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" name="budgetAllocated" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" name="budgetUsed" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" name="budgetRemaining" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5.2 Results -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.2 ‡∏î‡πâ‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h4>
                        
                        <!-- 5.2.1 Achievement -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.2.1 ‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="achievement" value="‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠" class="mr-2">
                                    <span>‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="achievement" value="‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠" class="mr-2">
                                    <span>‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="achievement" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå" class="mr-2">
                                    <span>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</span>
                                </label>
                            </div>
                            <textarea name="achievementDetail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." class="w-full px-3 py-2 border border-gray-300 rounded-md mt-2" rows="2"></textarea>
                        </div>

                        <!-- 5.2.2 Quantity -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.2.2 ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="quantityResult" value="‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                    <span>‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="quantityResult" value="‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                    <span>‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="quantityResult" value="‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                    <span>‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                                </label>
                            </div>
                        </div>

                        <!-- 5.2.3 Quality -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">5.2.3 ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="qualityResult" value="‡∏û‡∏≠‡πÉ‡∏à‡∏°‡∏≤‡∏Å" class="mr-2">
                                    <span>‡∏û‡∏≠‡πÉ‡∏à‡∏°‡∏≤‡∏Å</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="qualityResult" value="‡∏û‡∏≠‡πÉ‡∏à" class="mr-2">
                                    <span>‡∏û‡∏≠‡πÉ‡∏à</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="qualityResult" value="‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á" class="mr-2">
                                    <span>‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</span>
                                </label>
                            </div>
                        </div>

                        <!-- KPI Table -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</label>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (%)</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô (%)</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏™‡∏£‡∏∏‡∏õ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kpiTable">
                                        <tr>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <input type="text" name="kpi1" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà 1">
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <input type="number" name="target1" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <input type="number" name="result1" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <select name="summary1" class="w-full px-2 py-1 border-0 focus:ring-0">
                                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                                    <option value="‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                                                    <option value="‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                                                </select>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <button type="button" onclick="addKPIRow()" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î</button>
                            </div>
                        </div>
                    </div>

                    <!-- 5.3 Problems -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.3 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h4>
                        <div class="space-y-2">
                            <label class="flex items-start">
                                <input type="checkbox" name="problems" value="‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" class="mr-2 mt-1">
                                <span>‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                            </label>
                            <label class="flex items-start">
                                <input type="checkbox" name="problems" value="‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢" class="mr-2 mt-1">
                                <span>‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢/‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                            </label>
                            <label class="flex items-start">
                                <input type="checkbox" name="problems" value="‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô" class="mr-2 mt-1">
                                <span>‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ì‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</span>
                            </label>
                            <label class="flex items-start">
                                <input type="checkbox" name="problems" value="‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô" class="mr-2 mt-1">
                                <span>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô</span>
                            </label>
                        </div>
                        <textarea name="otherProblems" placeholder="‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô‡πÜ..." class="w-full px-3 py-2 border border-gray-300 rounded-md mt-3" rows="3"></textarea>
                    </div>

                    <!-- 5.4 Suggestions -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.4 ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</h4>
                        <textarea name="suggestions" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="4" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤..."></textarea>
                    </div>

                    <!-- 5.5 Summary -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3 text-purple-700">5.5 ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h4>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="finalResult" value="‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                <span>‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="finalResult" value="‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="mr-2">
                                <span>‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <input type="text" name="reporterName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" name="reportDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</label>
                        <div class="signature-pad rounded-lg p-4">
                            <canvas id="signatureCanvas" width="400" height="200" class="border-2 border-dashed border-gray-300 rounded cursor-crosshair"></canvas>
                        </div>
                        <div class="mt-2 space-x-2">
                            <button type="button" onclick="clearSignature()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                            <button type="button" onclick="saveSignature()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-6">
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ Google Sheets
                    </button>
                    <button type="button" onclick="generatePDF()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF
                    </button>
                    <button type="button" onclick="previewForm()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                        ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h3>
                        <button onclick="closePreview()" class="text-gray-500 hover:text-gray-700">‚úï</button>
                    </div>
                    <div id="previewContent" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="instructionsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets API</h3>
                        <button onclick="closeInstructions()" class="text-gray-500 hover:text-gray-700">‚úï</button>
                    </div>
                    <div class="space-y-4 text-sm">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:</h4>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://console.cloud.google.com" target="_blank" class="text-blue-600 underline">Google Cloud Console</a></li>
                                <li>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</li>
                                <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Google Sheets API</li>
                                <li>‡∏™‡∏£‡πâ‡∏≤‡∏á API Key ‡πÉ‡∏ô Credentials</li>
                                <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å API Key ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                            </ol>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets:</h4>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets ‡πÉ‡∏´‡∏°‡πà</li>
                                <li><strong>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô "Anyone with the link can EDIT"</strong> (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)</li>
                                <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sheets ID ‡∏à‡∏≤‡∏Å URL</li>
                                <li>‡πÉ‡∏™‡πà Sheets ID ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                                <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á</li>
                            </ol>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</h4>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Google Sheets ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</li>
                                <li>API Key ‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Sheets API</li>
                                <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button onclick="closeInstructions()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isDrawing = false;
        let signatureData = null;
        let kpiCounter = 1;
        let isGoogleSheetsConnected = false;
        let departmentChart = null;
        let successRateChart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSignaturePad();
            loadStoredConfig();
            loadDashboardData();
            document.querySelector('input[name="reportDate"]').value = new Date().toISOString().split('T')[0];
            
            // Auto-fill API credentials if they match provided values
            autoFillCredentials();
            
            // Show instructions on first visit
            if (!localStorage.getItem('hasSeenInstructions')) {
                setTimeout(() => {
                    showInstructions();
                    localStorage.setItem('hasSeenInstructions', 'true');
                }, 1000);
            }
        });

        // Auto-fill credentials for testing
        function autoFillCredentials() {
            const sheetsIdInput = document.getElementById('sheetsId');
            const apiKeyInput = document.getElementById('apiKey');
            
            if (!sheetsIdInput.value) {
                sheetsIdInput.value = '1hC88MRoGMYpHrwUvwS_mM9gwpJZuSBfiZqOftwVfywc';
            }
            if (!apiKeyInput.value) {
                apiKeyInput.value = 'AIzaSyBdr-oTmInHQL8WkoBzWx93VuvoRD4hWZo';
            }
        }

        // Improved Google Sheets API Functions
        function loadStoredConfig() {
            const storedSheetsId = localStorage.getItem('sheetsId');
            const storedApiKey = localStorage.getItem('apiKey');
            
            if (storedSheetsId) document.getElementById('sheetsId').value = storedSheetsId;
            if (storedApiKey) document.getElementById('apiKey').value = storedApiKey;
            
            if (storedSheetsId && storedApiKey) {
                testConnection();
            }
        }

        function saveConfig() {
            const sheetsId = document.getElementById('sheetsId').value;
            const apiKey = document.getElementById('apiKey').value;
            
            localStorage.setItem('sheetsId', sheetsId);
            localStorage.setItem('apiKey', apiKey);
        }

        async function testConnection() {
            const sheetsId = document.getElementById('sheetsId').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (!sheetsId || !apiKey) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Sheets ID ‡πÅ‡∏•‡∏∞ API Key', 'error');
                return;
            }
            
            saveConfig();
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'loading');
            
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetsId}?key=${apiKey}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus(`‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.properties.title}`, 'success');
                    isGoogleSheetsConnected = true;
                    document.getElementById('syncStatus').classList.remove('hidden');
                    syncFromSheets();
                } else {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.error?.message || response.statusText}`);
                }
            } catch (error) {
                showStatus(`‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`, 'error');
                isGoogleSheetsConnected = false;
                document.getElementById('syncStatus').classList.add('hidden');
            }
        }

        function createSheetsTemplate() {
            const sheetsId = document.getElementById('sheetsId').value;
            
            // Updated headers to match the data structure
            const headers = [
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', '‡∏ù‡πà‡∏≤‡∏¢', '‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå', '‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
                '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÉ‡∏ä‡πâ', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
                '‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå', '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå', '‡∏ú‡∏•‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì', '‡∏ú‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û', '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ',
                '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞', '‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', '‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'KPI_Data'
            ];
            
            showTemplateInstructions(headers, sheetsId);
        }

        function showTemplateInstructions(headers, sheetsId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            const sheetsLink = sheetsId ? 
                `<div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">‡∏•‡∏¥‡∏á‡∏Å‡πå Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</h4>
                    <a href="https://docs.google.com/spreadsheets/d/${sheetsId}/edit" target="_blank" 
                       class="text-blue-600 underline break-all">
                       https://docs.google.com/spreadsheets/d/${sheetsId}/edit
                    </a>
                </div>` :
                `<div class="bg-orange-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets ‡πÉ‡∏´‡∏°‡πà:</h4>
                    <p class="text-sm mb-2">1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://sheets.google.com" target="_blank" class="text-blue-600 underline">Google Sheets</a></p>
                    <p class="text-sm mb-2">2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà</p>
                    <p class="text-sm">3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sheets ID ‡∏à‡∏≤‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
                </div>`;
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï Google Sheets</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        
                        <div class="space-y-4">
                            ${sheetsLink}
                            
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï:</h4>
                                <ol class="list-decimal list-inside space-y-2 text-sm">
                                    <li>‡πÄ‡∏õ‡∏¥‡∏î Google Sheets (‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)</li>
                                    <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</li>
                                    <li>‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1 ‡∏Ç‡∏≠‡∏á Google Sheets (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå A1)</li>
                                    <li><strong>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô "Anyone with the link can EDIT"</strong> (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)</li>
                                    <li>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå</li>
                                    <li>‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà</li>
                                </ol>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å:</h4>
                                <div class="bg-white p-3 rounded border text-xs overflow-x-auto">
                                    <div class="whitespace-nowrap font-mono" style="font-size: 10px;">
                                        ${headers.join('\t')}
                                    </div>
                                </div>
                                <button onclick="copyHeaders()" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">
                                    ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                                </button>
                                <p class="text-xs text-gray-600 mt-1">‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Google Sheets ‡πÇ‡∏î‡∏¢‡∏Å‡∏î Ctrl+V</p>
                            </div>
                            
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</h4>
                                <ul class="list-disc list-inside space-y-1 text-sm">
                                    <li><strong>Google Sheets ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô "Anyone with the link can EDIT"</strong> (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà view)</li>
                                    <li>‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</li>
                                    <li>‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå</li>
                                    <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                                    <li>API Key ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Google Sheets API</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                                ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add copy function to window
            window.copyHeaders = function() {
                const text = headers.join('\t');
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:\n1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Sheets\n2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå A1\n3. ‡∏Å‡∏î Ctrl+V ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á');
                    }).catch(() => {
                        fallbackCopy();
                    });
                } else {
                    fallbackCopy();
                }
                
                function fallbackCopy() {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:\n1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Sheets\n2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå A1\n3. ‡∏Å‡∏î Ctrl+V ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á');
                    } catch (err) {
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
                    }
                    document.body.removeChild(textArea);
                }
            };
        }

        // Improved form data collection and Google Sheets saving
        function collectFormData(formData) {
            const data = {};
            
            // Handle regular form fields
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // Handle multiple values (like checkboxes)
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }
            
            // Handle checkbox groups properly
            const checkboxes = document.querySelectorAll('input[type="checkbox"][name="problems"]:checked');
            const selectedProblems = Array.from(checkboxes).map(cb => cb.value);
            data.problems = selectedProblems;
            
            // Collect KPI data
            const kpiData = [];
            for (let i = 1; i <= kpiCounter; i++) {
                const kpi = data[`kpi${i}`];
                const target = data[`target${i}`];
                const result = data[`result${i}`];
                const summary = data[`summary${i}`];
                
                if (kpi && kpi.trim()) {
                    kpiData.push({
                        kpi: kpi,
                        target: target || 0,
                        result: result || 0,
                        summary: summary || ''
                    });
                }
            }
            data.kpiData = kpiData;
            
            return data;
        }

        async function saveToGoogleSheets(data) {
    // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà deploy ‡πÅ‡∏•‡πâ‡∏ß
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyj3bytkbsclnUNw9YYEwIGPB376XDYw9efsKb9JRqhwwxIOS2_yGB_kZjRS7xJqhIhWw/exec';
    
    console.log('Saving to Google Sheets via Apps Script...');
    console.log('Data to save:', data);
    
    try {
        const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('Save successful! Result:', result);
        
        if (!result.success) {
            throw new Error(result.message);
        }
        
        return result;
        
    } catch (error) {
        console.error('Save error details:', error);
        throw new Error(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`);
    }
}
            
            // Prepare data row with proper encoding and structure
            const rowData = [
                new Date().toLocaleString('th-TH'),
                data.projectName || '',
                data.department || '',
                data.strategy || '',
                data.standard || '',
                data.timeline || '',
                data.responsible || '',
                data.timelineStatus || '',
                data.locationSuitability || '',
                data.equipmentQuantity || '',
                data.missingEquipment || '',
                data.equipmentQuality || '',
                data.personnelQuantity || '',
                data.cooperation || '',
                data.budgetAllocated || '',
                data.budgetUsed || '',
                data.budgetRemaining || '',
                data.achievement || '',
                data.achievementDetail || '',
                data.quantityResult || '',
                data.qualityResult || '',
                Array.isArray(data.problems) ? data.problems.join(', ') : (data.problems || ''),
                data.otherProblems || '',
                data.suggestions || '',
                data.finalResult || '',
                data.reporterName || '',
                data.reportDate || '',
                JSON.stringify(data.kpiData || [])
            ];
            
            console.log('Row data prepared:', rowData);
            
            try {
                // Step 1: Get sheet metadata
                console.log('Getting sheet metadata...');
                const metadataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetsId}?key=${apiKey}`;
                
                const metadataResponse = await fetch(metadataUrl);
                
                if (!metadataResponse.ok) {
                    const errorText = await metadataResponse.text();
                    console.error('Metadata error response:', errorText);
                    
                    if (metadataResponse.status === 403) {
                        throw new Error('API Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets API\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key ‡πÉ‡∏ô Google Cloud Console\n2. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Google Sheets API\n3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key Restrictions ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    } else if (metadataResponse.status === 404) {
                        throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö Google Sheets ‡∏´‡∏£‡∏∑‡∏≠ Sheets ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Sheets ID ‡∏à‡∏≤‡∏Å URL\n2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå Google Sheets');
                    } else if (metadataResponse.status === 400) {
                        throw new Error('‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Sheets ID ‡πÅ‡∏•‡∏∞ API Key');
                    } else {
                        throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets ‡πÑ‡∏î‡πâ (${metadataResponse.status})\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${errorText}`);
                    }
                }
                
                const sheetMetadata = await metadataResponse.json();
                console.log('Sheet metadata received:', sheetMetadata.properties?.title);
                
                // Get the first sheet name
                const firstSheet = sheetMetadata.sheets?.[0];
                if (!firstSheet) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Google Sheets');
                }
                
                const sheetName = firstSheet.properties.title;
                console.log('Using sheet name:', sheetName);
                
                // Step 2: Check if sheet has headers
                console.log('Checking sheet headers...');
                const checkUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetsId}/values/${encodeURIComponent(sheetName)}!A1:AB1?key=${apiKey}`;
                
                const checkResponse = await fetch(checkUrl);
                
                if (checkResponse.ok) {
                    const checkData = await checkResponse.json();
                    const existingHeaders = checkData.values?.[0] || [];
                    console.log('Existing headers:', existingHeaders);
                    
                    if (existingHeaders.length === 0) {
                        console.log('No headers found, sheet might be empty');
                        throw new Error('Google Sheets ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï"\n2. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Google Sheets\n3. ‡∏•‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                    }
                }
                
                // Step 3: Append data
                console.log('Appending data to sheet...');
                const appendUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetsId}/values/${encodeURIComponent(sheetName)}:append?valueInputOption=USER_ENTERED&insertDataOption=INSERT_ROWS&key=${apiKey}`;
                
                const appendPayload = {
                    values: [rowData]
                };
                console.log('Append payload:', JSON.stringify(appendPayload, null, 2));
                
                const appendResponse = await fetch(appendUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(appendPayload)
                });
                
                console.log('Append response status:', appendResponse.status);
                
                if (!appendResponse.ok) {
                    const errorData = await appendResponse.text();
                    console.error('Append error response:', errorData);
                    
                    let parsedError;
                    try {
                        parsedError = JSON.parse(errorData);
                    } catch (e) {
                        parsedError = { error: { message: errorData } };
                    }
                    
                    if (appendResponse.status === 400) {
                        throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô Google Sheets\n2. ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÉ‡∏´‡∏°‡πà\n3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å merge');
                    } else if (appendResponse.status === 403) {
                        throw new Error('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå Google Sheets ‡πÄ‡∏õ‡πá‡∏ô "Anyone with the link can EDIT"\n2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ API Key ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Sheets API\n3. ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á API Key ‡πÉ‡∏´‡∏°‡πà');
                    } else {
                        throw new Error(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${appendResponse.status})\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${parsedError.error?.message || '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}`);
                    }
                }
                
                const result = await appendResponse.json();
                console.log('Save successful! Result:', result);
                console.log('Updated range:', result.updates?.updatedRange);
                console.log('Rows added:', result.updates?.updatedRows);
                
                return result;
                
            } catch (error) {
                console.error('Save error details:', error);
                
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï\n2. ‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö\n3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Google Sheets API ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥');
                }
                
                // Re-throw the error with original message if it's already formatted
                throw error;
            }
        }

        async function syncFromSheets() {
            const sheetsId = document.getElementById('sheetsId').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (!isGoogleSheetsConnected) return;
            
            try {
                // First get sheet info to find the correct sheet name
                const sheetInfoResponse = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetsId}?key=${apiKey}`
                );
                
                if (sheetInfoResponse.ok) {
                    const sheetInfo = await sheetInfoResponse.json();
                    const firstSheetName = sheetInfo.sheets[0].properties.title;
                    
                    // Now get data from the correct sheet
                    const response = await fetch(
                        `https://sheets.googleapis.com/v4/spreadsheets/${sheetsId}/values/${encodeURIComponent(firstSheetName)}?key=${apiKey}`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        const rows = data.values || [];
                        
                        if (rows.length > 1) {
                            // Convert rows to project objects (skip header row)
                            const projects = rows.slice(1).map(row => ({
                                timestamp: row[0] || '',
                                projectName: row[1] || '',
                                department: row[2] || '',
                                responsible: row[6] || '',
                                finalResult: row[24] || '',
                                reportDate: row[26] || ''
                            }));
                            
                            // Update dashboard with Google Sheets data
                            updateDashboardWithData(projects);
                        }
                    }
                }
            } catch (error) {
                console.error('Sync error:', error);
            }
        }

        function updateDashboardWithData(projects) {
            // Update statistics
            document.getElementById('totalProjects').textContent = projects.length;
            
            const successCount = projects.filter(p => p.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
            const failedCount = projects.filter(p => p.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢').length;
            const pendingCount = projects.filter(p => !p.finalResult || p.finalResult === '').length;
            
            document.getElementById('successProjects').textContent = successCount;
            document.getElementById('failedProjects').textContent = failedCount;
            document.getElementById('pendingProjects').textContent = pendingCount;
            
            // Update charts
            updateCharts(projects);
            
            // Update projects list
            const projectsList = document.getElementById('projectsList');
            if (projects.length === 0) {
                projectsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets</p>';
            } else {
                projectsList.innerHTML = projects.slice(-5).reverse().map(project => `
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-medium text-gray-900">${project.projectName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£'}</h4>
                                <p class="text-sm text-gray-600">‡∏ù‡πà‡∏≤‡∏¢: ${project.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                <p class="text-sm text-gray-600">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ${project.responsible || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                    project.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? 'bg-green-100 text-green-800' :
                                    project.finalResult === '‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' ? 'bg-red-100 text-red-800' :
                                    'bg-yellow-100 text-yellow-800'
                                }">
                                    ${project.finalResult || '‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'}
                                </span>
                                <p class="text-xs text-gray-500 mt-1">${project.timestamp || project.reportDate}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateCharts(projects) {
            // Prepare data for department chart
            const departmentData = {};
            const departmentSuccess = {};
            
            // Initialize departments
            const departments = ['‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'];
            departments.forEach(dept => {
                departmentData[dept] = 0;
                departmentSuccess[dept] = { success: 0, total: 0 };
            });
            
            // Count projects by department
            projects.forEach(project => {
                const dept = project.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!departmentData[dept]) {
                    departmentData[dept] = 0;
                    departmentSuccess[dept] = { success: 0, total: 0 };
                }
                
                departmentData[dept]++;
                departmentSuccess[dept].total++;
                
                if (project.finalResult === '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢') {
                    departmentSuccess[dept].success++;
                }
            });
            
            // Create department chart
            createDepartmentChart(departmentData);
            
            // Create success rate chart
            createSuccessRateChart(departmentSuccess);
        }

        function createDepartmentChart(data) {
            const ctx = document.getElementById('departmentChart').getContext('2d');
            
            // Destroy existing chart
            if (departmentChart) {
                departmentChart.destroy();
            }
            
            const labels = Object.keys(data);
            const values = Object.values(data);
            const colors = [
                '#3B82F6', // Blue
                '#10B981', // Green  
                '#F59E0B', // Yellow
                '#EF4444', // Red
                '#8B5CF6', // Purple
                '#06B6D4', // Cyan
                '#84CC16', // Lime
                '#F97316'  // Orange
            ];
            
            departmentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    family: 'Sarabun',
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (${percentage}%)`;
                                }
                            },
                            titleFont: {
                                family: 'Sarabun'
                            },
                            bodyFont: {
                                family: 'Sarabun'
                            }
                        }
                    }
                }
            });
        }

        function createSuccessRateChart(data) {
            const ctx = document.getElementById('successRateChart').getContext('2d');
            
            // Destroy existing chart
            if (successRateChart) {
                successRateChart.destroy();
            }
            
            const labels = Object.keys(data);
            const successRates = labels.map(dept => {
                const deptData = data[dept];
                return deptData.total > 0 ? ((deptData.success / deptData.total) * 100).toFixed(1) : 0;
            });
            const totalProjects = labels.map(dept => data[dept].total);
            
            successRateChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (%)',
                        data: successRates,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)', 
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(6, 182, 212, 0.8)',
                            'rgba(132, 204, 22, 0.8)',
                            'rgba(249, 115, 22, 0.8)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(139, 92, 246, 1)',
                            'rgba(6, 182, 212, 1)',
                            'rgba(132, 204, 22, 1)',
                            'rgba(249, 115, 22, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const deptIndex = context.dataIndex;
                                    const dept = labels[deptIndex];
                                    const rate = context.parsed.y;
                                    const total = totalProjects[deptIndex];
                                    const success = data[dept].success;
                                    return [
                                        `‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${rate}%`,
                                        `‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${success}/${total}`
                                    ];
                                }
                            },
                            titleFont: {
                                family: 'Sarabun'
                            },
                            bodyFont: {
                                family: 'Sarabun'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    family: 'Sarabun'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Sarabun'
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('connectionStatus');
            const messageDiv = document.getElementById('statusMessage');
            
            statusDiv.classList.remove('hidden');
            messageDiv.textContent = message;
            
            // Remove existing type classes
            statusDiv.classList.remove('bg-green-100', 'bg-red-100', 'bg-yellow-100', 'bg-blue-100');
            
            // Add appropriate class based on type
            switch(type) {
                case 'success':
                    statusDiv.classList.add('bg-green-100');
                    break;
                case 'error':
                    statusDiv.classList.add('bg-red-100');
                    break;
                case 'loading':
                    statusDiv.classList.add('bg-blue-100');
                    break;
                default:
                    statusDiv.classList.add('bg-yellow-100');
            }
            
            // Auto hide after 5 seconds for non-error messages
            if (type !== 'error') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 5000);
            }
        }

        function toggleConfig() {
            const panel = document.getElementById('configPanel');
            panel.classList.toggle('hidden');
        }

        function showInstructions() {
            document.getElementById('instructionsModal').classList.remove('hidden');
        }

        function closeInstructions() {
            document.getElementById('instructionsModal').classList.add('hidden');
        }

        // Navigation functions
        function showDashboard() {
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('formSection').classList.add('hidden');
            if (isGoogleSheetsConnected) {
                syncFromSheets();
            } else {
                loadDashboardData();
            }
        }

        function showForm() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('formSection').classList.remove('hidden');
        }

        // Signature pad functions
        function initializeSignaturePad() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }

            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000';
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            }

            function stopDrawing() {
                isDrawing = false;
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                 e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        function clearSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            signatureData = null;
        }

        function saveSignature() {
            const canvas = document.getElementById('signatureCanvas');
            signatureData = canvas.toDataURL();
            alert('‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
        }

        // KPI table functions
        function addKPIRow() {
            kpiCounter++;
            const table = document.getElementById('kpiTable');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="border border-gray-300 px-4 py-2">
                    <input type="text" name="kpi${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà ${kpiCounter}">
                </td>
                <td class="border border-gray-300 px-4 py-2">
                    <input type="number" name="target${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                </td>
                <td class="border border-gray-300 px-4 py-2">
                    <input type="number" name="result${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0" placeholder="0">
                </td>
                <td class="border border-gray-300 px-4 py-2">
                    <select name="summary${kpiCounter}" class="w-full px-2 py-1 border-0 focus:ring-0">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                        <option value="‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                        <option value="‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏">‡πÑ‡∏°‡πà‡∏ö‡∏£‡∏£‡∏•‡∏∏</option>
                    </select>
                </td>
            `;
            table.appendChild(row);
        }

        // Enhanced Form submission with better error handling
        document.getElementById('projectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = collectFormData(formData);
            
            // Add signature
            if (signatureData) {
                data.signature = signatureData;
            }
            
            // Add timestamp
            data.timestamp = new Date().toISOString();
            
            // Try to save to Google Sheets first
            if (isGoogleSheetsConnected) {
                try {
                    showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets...', 'loading');
                    await saveToGoogleSheets(data);
                    showStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    
                    // Also save locally as backup
                    saveToStorage(data);
                    
                    // Clear form
                    document.getElementById('projectForm').reset();
                    clearSignature();
                    
                    // Refresh dashboard
                    setTimeout(() => {
                        syncFromSheets();
                    }, 1000);
                    
                } catch (error) {
                    showStatus(`${error.message}`, 'error');
                    // Fallback to local storage
                    saveToStorage(data);
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏™‡∏≥‡∏£‡∏≠‡∏á)');
                }
            } else {
                // Save to localStorage only
                saveToStorage(data);
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
                loadDashboardData();
            }
        });

        // Storage functions (fallback)
        function saveToStorage(data) {
            let projects = JSON.parse(localStorage.getItem('projects') || '[]');
            projects.push(data);
            localStorage.setItem('projects', JSON.stringify(projects));
        }

        function loadDashboardData() {
            if (isGoogleSheetsConnected) {
                syncFromSheets();
                return;
            }
            
            const projects = JSON.parse(localStorage.getItem('projects') || '[]');
            updateDashboardWithData(projects);
        }

        // Preview function
        function previewForm() {
            const formData = new FormData(document.getElementById('projectForm'));
            const data = collectFormData(formData);
            
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-xl font-bold">‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568</h2>
                    <p>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
                </div>
                
                <div class="space-y-4">
                    <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</strong> ${data.projectName || '-'}</div>
                    <div><strong>‡∏ù‡πà‡∏≤‡∏¢:</strong> ${data.department || '-'}</div>
                    <div><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ${data.responsible || '-'}</div>
                    <div><strong>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${data.timeline || '-'}</div>
                    <div><strong>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</strong> ${data.finalResult || '-'}</div>
                    <div><strong>‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:</strong> ${data.reporterName || '-'}</div>
                    <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${data.reportDate || '-'}</div>
                    ${data.kpiData && data.kpiData.length > 0 ? `
                    <div><strong>‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î:</strong>
                        <ul class="list-disc list-inside ml-4">
                            ${data.kpiData.map(kpi => `<li>${kpi.kpi}: ${kpi.result}/${kpi.target}% (${kpi.summary})</li>`).join('')}
                        </ul>
                    </div>` : ''}
                </div>
            `;
            
            document.getElementById('previewModal').classList.remove('hidden');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.add('hidden');
        }

        // PDF generation with enhanced Thai font support
        function generatePDF() {
            try {
                console.log('Starting PDF generation...');
                
                // Use browser's print functionality for better Thai support
                const shouldUseBrowserPrint = confirm('‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\n\n‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF:\n\n‡∏Å‡∏î "‡∏ï‡∏Å‡∏•‡∏á" = ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)\n‡∏Å‡∏î "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" = ‡πÉ‡∏ä‡πâ jsPDF (‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)');
                
                if (shouldUseBrowserPrint) {
                    generatePDFViaBrowser();
                    return;
                }
                
                // Continue with jsPDF approach
                const { jsPDF } = window.jspdf;
                
                // Create PDF with enhanced settings
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4',
                    compress: true
                });
                
                console.log('jsPDF initialized');
                
                // Get form data
                const formData = new FormData(document.getElementById('projectForm'));
                const data = collectFormData(formData);
                
                // Enhanced text rendering function
                function addText(text, x, y, fontSize = 12, options = {}) {
                    doc.setFontSize(fontSize);
                    
                    // Clean and prepare text
                    let cleanText = text.toString().trim();
                    
                    // Handle empty text
                    if (!cleanText || cleanText === 'undefined' || cleanText === 'null') {
                        cleanText = '-';
                    }
                    
                    // Split text for wrapping
                    const maxWidth = options.maxWidth || 170;
                    const lines = doc.splitTextToSize(cleanText, maxWidth);
                    const lineHeight = fontSize * 0.5;
                    
                    if (Array.isArray(lines)) {
                        lines.forEach((line, index) => {
                            try {
                                doc.text(line, x, y + (index * lineHeight));
                            } catch (textError) {
                                console.warn('Text rendering error:', textError);
                                // Fallback: render as ASCII
                                const asciiLine = line.replace(/[^\x00-\x7F]/g, '?');
                                doc.text(asciiLine + ' (Thai text)', x, y + (index * lineHeight));
                            }
                        });
                        return y + (lines.length * lineHeight);
                    } else {
                        try {
                            doc.text(cleanText, x, y);
                        } catch (textError) {
                            console.warn('Single text rendering error:', textError);
                            const asciiText = cleanText.replace(/[^\x00-\x7F]/g, '?');
                            doc.text(asciiText + ' (Thai text)', x, y);
                        }
                        return y + lineHeight;
                    }
                }
                
                let yPos = 20;
                const pageWidth = doc.internal.pageSize.getWidth();
                
                // Header with better centering
                doc.setFontSize(16);
                const headerText1 = 'Project Evaluation Report - Fiscal Year 2568';
                const headerText2 = 'Sa School, Wiang Sa District, Nan Province';
                
                // Center the headers
                doc.text(headerText1, pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                
                doc.setFontSize(14);
                doc.text(headerText2, pageWidth / 2, yPos, { align: 'center' });
                yPos += 15;
                
                // Add Thai headers as well
                doc.setFontSize(12);
                yPos = addText('‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568', 20, yPos, 12);
                yPos = addText('‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô', 20, yPos + 3, 12);
                yPos += 10;
                
                // Draw separator line
                doc.setLineWidth(0.5);
                doc.line(20, yPos, pageWidth - 20, yPos);
                yPos += 10;
                
                // Project Information
                doc.setFontSize(14);
                doc.text('1. Project Information / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', 20, yPos);
                yPos += 8;
                
                const projectFields = [
                    ['Project Name / ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', data.projectName || '-'],
                    ['Department / ‡∏ù‡πà‡∏≤‡∏¢', data.department || '-'],
                    ['Strategy / ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå', data.strategy || '-'],
                    ['Standard / ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', data.standard || '-'],
                    ['Timeline / ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', data.timeline || '-'],
                    ['Responsible / ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö', data.responsible || '-']
                ];
                
                doc.setFontSize(11);
                projectFields.forEach(([label, value]) => {
                    yPos = addText(`${label}: ${value}`, 25, yPos + 5, 11);
                });
                
                yPos += 10;
                
                // Results Section
                doc.setFontSize(14);
                doc.text('2. Results / ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô', 20, yPos);
                yPos += 8;
                
                const resultFields = [
                    ['Timeline Status / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', data.timelineStatus || '-'],
                    ['Location Suitability / ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà', data.locationSuitability || '-'],
                    ['Equipment Quantity / ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', data.equipmentQuantity || '-'],
                    ['Equipment Quality / ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', data.equipmentQuality || '-'],
                    ['Personnel / ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£', data.personnelQuantity || '-'],
                    ['Cooperation / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠', data.cooperation || '-']
                ];
                
                // Add budget information
                if (data.budgetAllocated) {
                    resultFields.push(['Budget Allocated / ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£', `${data.budgetAllocated} THB`]);
                }
                if (data.budgetUsed) {
                    resultFields.push(['Budget Used / ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÉ‡∏ä‡πâ', `${data.budgetUsed} THB`]);
                }
                
                doc.setFontSize(11);
                resultFields.forEach(([label, value]) => {
                    yPos = addText(`${label}: ${value}`, 25, yPos + 5, 11);
                });
                
                yPos += 10;
                
                // Achievement
                if (data.achievement) {
                    doc.setFontSize(14);
                    doc.text('3. Achievement / ‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå', 20, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(11);
                    yPos = addText(`Result / ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ${data.achievement}`, 25, yPos, 11);
                    
                    if (data.achievementDetail) {
                        yPos = addText(`Details / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${data.achievementDetail}`, 25, yPos + 3, 11);
                    }
                    yPos += 10;
                }
                
                // Problems
                if (data.otherProblems) {
                    doc.setFontSize(14);
                    doc.text('4. Problems / ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', 20, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(11);
                    yPos = addText(data.otherProblems, 25, yPos, 11);
                    yPos += 10;
                }
                
                // Suggestions
                if (data.suggestions) {
                    doc.setFontSize(14);
                    doc.text('5. Suggestions / ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞', 20, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(11);
                    yPos = addText(data.suggestions, 25, yPos, 11);
                    yPos += 10;
                }
                
                // Final Result
                if (data.finalResult) {
                    doc.setFontSize(14);
                    doc.text('6. Final Evaluation / ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', 20, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(12);
                    yPos = addText(`Result / ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: ${data.finalResult}`, 25, yPos, 12);
                    yPos += 15;
                }
                
                // Signature section
                doc.setFontSize(14);
                doc.text('7. Reporter Signature / ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 20, yPos);
                yPos += 10;
                
                if (data.reporterName) {
                    doc.setFontSize(11);
                    yPos = addText(`Reporter Name / ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${data.reporterName}`, 25, yPos, 11);
                }
                
                if (data.reportDate) {
                    const reportDate = new Date(data.reportDate);
                    const thaiDate = reportDate.toLocaleDateString('th-TH');
                    const engDate = reportDate.toLocaleDateString('en-US');
                    yPos = addText(`Date / ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${engDate} (${thaiDate})`, 25, yPos + 5, 11);
                }
                
                // Add signature if available
                if (signatureData) {
                    yPos += 10;
                    doc.text('Signature / ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô:', 25, yPos);
                    try {
                        doc.addImage(signatureData, 'PNG', 25, yPos + 5, 50, 25);
                    } catch (imgError) {
                        console.warn('Signature image error:', imgError);
                        doc.text('(Electronic Signature / ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå)', 25, yPos + 10);
                    }
                }
                
                // Generate filename
                const date = new Date().toISOString().split('T')[0];
                const filename = `Project_Evaluation_${date}.pdf`;
                
                console.log('Saving PDF...');
                doc.save(filename);
                
                alert('PDF ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: jsPDF ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\n\n‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå" ‡πÅ‡∏ó‡∏ô');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF\n\n‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏∑‡πà‡∏ô:\n1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á" ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ Ctrl+P\n2. ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå"');
            }
        }
        
        // Alternative PDF generation using browser's print functionality
        function generatePDFViaBrowser() {
            console.log('Using browser print for PDF generation...');
            
            // Get form data
            const formData = new FormData(document.getElementById('projectForm'));
            const data = collectFormData(formData);
            
            // Create a new window with print-friendly content
            const printWindow = window.open('', '_blank');
            
            // Build the HTML content with proper Thai font support
            const htmlContent = `
                <!DOCTYPE html>
                <html lang="th">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</title>
                    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                    <style>
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none !important; }
                        }
                        body {
                            font-family: 'Sarabun', 'TH Sarabun New', sans-serif;
                            font-size: 14px;
                            line-height: 1.6;
                            color: #333;
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 20px;
                            background: white;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                        }
                        .header h1 {
                            font-size: 20px;
                            font-weight: 600;
                            margin: 0 0 10px 0;
                        }
                        .header h2 {
                            font-size: 16px;
                            font-weight: 400;
                            margin: 0;
                            color: #666;
                        }
                        .section {
                            margin-bottom: 25px;
                        }
                        .section-title {
                            font-size: 16px;
                            font-weight: 600;
                            color: #2563eb;
                            margin-bottom: 15px;
                            border-left: 4px solid #2563eb;
                            padding-left: 10px;
                        }
                        .field {
                            margin-bottom: 12px;
                            display: flex;
                            flex-wrap: wrap;
                        }
                        .field-label {
                            font-weight: 500;
                            min-width: 200px;
                            color: #374151;
                        }
                        .field-value {
                            flex: 1;
                            color: #111827;
                        }
                        .signature-section {
                            margin-top: 40px;
                            border-top: 1px solid #e5e7eb;
                            padding-top: 20px;
                        }
                        .signature-box {
                            border: 1px solid #d1d5db;
                            height: 80px;
                            width: 200px;
                            margin: 10px 0;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: #6b7280;
                        }
                        @page {
                            size: A4;
                            margin: 2cm;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568</h1>
                        <h2>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</h2>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
                        <div class="field">
                            <div class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</div>
                            <div class="field-value">${data.projectName || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏ù‡πà‡∏≤‡∏¢:</div>
                            <div class="field-value">${data.department || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà:</div>
                            <div class="field-value">${data.strategy || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™‡∏û‡∏ê.:</div>
                            <div class="field-value">${data.standard || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô:</div>
                            <div class="field-value">${data.timeline || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</div>
                            <div class="field-value">${data.responsible || '-'}</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">2. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</div>
                        <div class="field">
                            <div class="field-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</div>
                            <div class="field-value">${data.timelineStatus || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</div>
                            <div class="field-value">${data.locationSuitability || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</div>
                            <div class="field-value">${data.equipmentQuantity || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</div>
                            <div class="field-value">${data.equipmentQuality || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£:</div>
                            <div class="field-value">${data.personnelQuantity || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠:</div>
                            <div class="field-value">${data.cooperation || '-'}</div>
                        </div>
                        ${data.budgetAllocated ? `
                        <div class="field">
                            <div class="field-label">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£:</div>
                            <div class="field-value">${data.budgetAllocated} ‡∏ö‡∏≤‡∏ó</div>
                        </div>` : ''}
                        ${data.budgetUsed ? `
                        <div class="field">
                            <div class="field-label">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÉ‡∏ä‡πâ‡πÑ‡∏õ:</div>
                            <div class="field-value">${data.budgetUsed} ‡∏ö‡∏≤‡∏ó</div>
                        </div>` : ''}
                    </div>
                    
                    ${data.achievement ? `
                    <div class="section">
                        <div class="section-title">3. ‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
                        <div class="field">
                            <div class="field-label">‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå:</div>
                            <div class="field-value">${data.achievement}</div>
                        </div>
                        ${data.achievementDetail ? `
                        <div class="field">
                            <div class="field-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</div>
                            <div class="field-value">${data.achievementDetail}</div>
                        </div>` : ''}
                    </div>` : ''}
                    
                    ${data.otherProblems ? `
                    <div class="section">
                        <div class="section-title">4. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ</div>
                        <div class="field-value">${data.otherProblems}</div>
                    </div>` : ''}
                    
                    ${data.suggestions ? `
                    <div class="section">
                        <div class="section-title">5. ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</div>
                        <div class="field-value">${data.suggestions}</div>
                    </div>` : ''}
                    
                    ${data.finalResult ? `
                    <div class="section">
                        <div class="section-title">6. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</div>
                        <div class="field-value"><strong>${data.finalResult}</strong></div>
                    </div>` : ''}
                    
                    <div class="signature-section">
                        <div class="section-title">7. ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                        <div class="field">
                            <div class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:</div>
                            <div class="field-value">${data.reporterName || '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</div>
                            <div class="field-value">${data.reportDate ? new Date(data.reportDate).toLocaleDateString('th-TH', {
                                year: 'numeric',
                                month: 'long', 
                                day: 'numeric'
                            }) : '-'}</div>
                        </div>
                        <div class="field">
                            <div class="field-label">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô:</div>
                            <div class="signature-box">
                                ${signatureData ? '<img src="' + signatureData + '" style="max-width: 180px; max-height: 60px;">' : '(‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå)'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="no-print" style="text-align: center; margin-top: 30px; padding: 20px; background: #f3f4f6; border-radius: 8px;">
                        <p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF:</strong></p>
                        <p>1. ‡∏Å‡∏î Ctrl+P (Windows) ‡∏´‡∏£‡∏∑‡∏≠ Cmd+P (Mac)</p>
                        <p>2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Save as PDF" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF"</p>
                        <p>3. ‡∏Å‡∏î "Save" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"</p>
                        <button onclick="window.print()" style="background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">‡∏û‡∏¥‡∏°‡∏û‡πå/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</button>
                        <button onclick="window.close()" style="background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; margin-left: 10px;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            
            // Auto-focus the print window
            printWindow.focus();
            
            // Show instructions
            setTimeout(() => {
                alert('‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF:\n1. ‡∏Å‡∏î Ctrl+P (Windows) ‡∏´‡∏£‡∏∑‡∏≠ Cmd+P (Mac)\n2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Save as PDF"\n3. ‡∏Å‡∏î "Save"\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!');
            }, 500);
        }

        // Initialize dashboard on load
        showDashboard();
    </script>
</body>
</html>

